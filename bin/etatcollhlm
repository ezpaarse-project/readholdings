#!/usr/bin/env node

const program = require('commander');
const pkg = require('../package.json');

const logger = require('../lib/logger');

const { config } = require('./cmds/config');
const { ping } = require('./cmds/ping');
const { insertion } = require('./cmds/insert');
const { reset, init } = require('./cmds/index');
const { info } = require('./cmds/info');
const { download } = require('./cmds/download');

program.on('command:*', () => {
  logger.error(`Invalid command: ${program.args.join(' ')}\nSee --help for a list of available commands.`);
  process.exit(1);
});

program.version(pkg.version);

program
  .command('config')
  .description('Make the config to fetch a elastic cluster')
  .option('-g --get', 'display the configuration')
  .option('-s --set', 'initialize the configuration file in $HOME/.config')
  .option('--url <url>', 'elastic url')
  .option('--port <port>', 'elastic port')
  .option('--user <user>', 'elastic user')
  .option('--password <password>', 'elastic password')
  .option('--institutes <institutes>', 'custif and apikey of institute in JSON format')
  .option('-l --list', 'list of attributes required for configuration')
  .action((args) => config(args));

program
  .command('ping')
  .description('Check if service is available')
  .option('-u --use <use>', 'use a custom config')
  .action((args) => ping(args));

program
  .command('init')
  .description('Init elastic index')
  .option('-u --use <use>', 'use a custom config')
  .action((args) => init(args));

program
  .command('download')
  .description('Recovers data from ebsco to put them in a csv file in "standard" format')
  .option('-i --institute <institute>', 'institute Name')
  .option('-r --resume', 'resume downloading where it left off')
  .option('-u --use <use>', 'use a custom config')
  .option('-o --out <out>', 'destination of downloading file')
  .action((args) => download(args));

program
  .command('insert')
  .description('insert the contents of a file into an elastic')
  .option('-f --file <file>', 'file to which its content is inserted in a elastic')
  .option('-v --verbose', 'verbose')
  .option('-u --use <use>', 'use a custom config')
  .action((args) => insertion(args));

program
  .command('info')
  .description('Info of elastic index')
  .option('-u --use <use>', 'use a custom config')
  .action((args) => info(args));

program
  .command('reset')
  .description('Empty elastic index')
  .option('-u --use <use>', 'use a custom config')
  .action((args) => reset(args));

program.parse(process.argv);
